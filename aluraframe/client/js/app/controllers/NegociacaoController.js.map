{"version":3,"sources":["../../app-es6/controllers/NegociacaoController.js"],"names":["ListaNegociacoes","Mensagem","NegociacoesView","MensagemView","NegociacaoService","DateHelper","Bind","Negociacao","NegociacaoController","$","document","querySelector","bind","_inputData","_inputQuantidade","_inputValor","_ordemAtual","_listaNegociacoes","_mensagem","_service","_init","lista","then","negociacoes","forEach","adiciona","negociacao","catch","console","log","erro","texto","setInterval","importaNegociacoes","event","preventDefault","_criaNegociacao","cadastra","mensagem","_limpaForm","textoParaData","value","parseInt","parseFloat","focus","apaga","esvazia","importa","error","coluna","inverteOrdem","ordena","a","b","negociacaoController","currentInstance"],"mappings":"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","file":"NegociacaoController.js","sourcesContent":["import {ListaNegociacoes} from '../models/ListaNegociacoes';\r\nimport {Mensagem} from '../models/Mensagem';\r\nimport {NegociacoesView} from '../views/NegociacoesView';\r\nimport {MensagemView} from '../views/MensagemView';\r\nimport {NegociacaoService} from '../services/NegociacaoService';\r\nimport {DateHelper} from '../helpers/DateHelper';\r\nimport {Bind} from '../helpers/Bind';\r\nimport {Negociacao} from '../models/Negociacao';\r\n\r\nclass NegociacaoController{\r\n\r\n    constructor(){\r\n        let $ = document.querySelector.bind(document);\r\n    \r\n        this._inputData = $(\"#data\");\r\n        this._inputQuantidade = $(\"#quantidade\");\r\n        this._inputValor = $(\"#valor\");\r\n        this._ordemAtual = '';\r\n        \r\n\r\n        this._listaNegociacoes = new Bind(new ListaNegociacoes(), new NegociacoesView($(\"#negociacoesView\")), 'adiciona', 'esvazia', 'ordena', 'inverteOrdem');\r\n\r\n        this._mensagem = new Bind(new Mensagem(), new MensagemView($(\"#mensagemView\")), 'texto');\r\n\r\n        this._service = new NegociacaoService();\r\n\r\n        this._init();\r\n\r\n    }\r\n    \r\n    _init(){\r\n        \r\n        \r\n        this._service.lista()\r\n        .then(negociacoes => \r\n                negociacoes.forEach(negociacao => \r\n                this._listaNegociacoes.adiciona(negociacao)))\r\n        .catch(erro => {\r\n            console.log(erro);\r\n            this._mensagem.texto = erro;\r\n        });\r\n    \r\n        setInterval(() => {\r\n            this.importaNegociacoes();\r\n        }, 3000);\r\n\r\n    }\r\n\r\n    adiciona(event){\r\n        \r\n        event.preventDefault(); \r\n\r\n        let negociacao = this._criaNegociacao();\r\n\r\n        this._service.cadastra(negociacao)\r\n        .then(mensagem => {\r\n            this._listaNegociacoes.adiciona(negociacao);\r\n            this._mensagem.texto = mensagem;\r\n            this._limpaForm();\r\n        }).catch(erro => this._mensagem.texto = erro);\r\n        \r\n    }\r\n\r\n    _criaNegociacao(){\r\n        return new Negociacao(DateHelper.textoParaData(this._inputData.value), parseInt(this._inputQuantidade.value), parseFloat(this._inputValor.value));\r\n    }\r\n\r\n    _limpaForm(){\r\n        this._inputData.value = \"\";\r\n        this._inputQuantidade.value = \"1\";\r\n        this._inputValor.value = \"0.0\";\r\n\r\n        this._inputData.focus();\r\n    }\r\n\r\n    apaga(){\r\n\r\n        this._service.apaga()\r\n        .then(mensagem => {\r\n            this._mensagem.texto = mensagem;\r\n            this._listaNegociacoes.esvazia();\r\n        }).catch(erro => this._mensagem.texto = erro);\r\n    }\r\n\r\n    importaNegociacoes() {\r\n\r\n        this._service.importa(this._listaNegociacoes.negociacoes)\r\n        .then(negociacoes => {\r\n          negociacoes.forEach(negociacao => this._listaNegociacoes.adiciona(negociacao));\r\n          this._mensagem.texto = 'Negociações do período importadas com sucesso';\r\n        })\r\n        .catch(error => this._mensagem.texto = error);  \r\n    }\r\n\r\n    ordena(coluna){\r\n        if (this._ordemAtual == coluna) {\r\n            this._listaNegociacoes.inverteOrdem();\r\n        }else{\r\n            this._listaNegociacoes.ordena((a,b) => a[coluna] - b[coluna]);    \r\n        }\r\n\r\n        this._ordemAtual = coluna;\r\n    }\r\n\r\n}\r\n\r\nlet negociacaoController = new NegociacaoController();\r\n\r\nexport function currentInstance() {\r\n    return negociacaoController;\r\n}"]}